/*
	MIT License http://www.opensource.org/licenses/mit-license.php
*/

"use strict";

const { register } = require("./serialization");

<<<<<<< HEAD
=======
/** @typedef {import("../serialization/ObjectMiddleware").Constructor} Constructor */

>>>>>>> 39788b5e01a4817c1ea46a2f2383841e87dacb23
class ClassSerializer {
	constructor(Constructor) {
		this.Constructor = Constructor;
	}

	serialize(obj, context) {
		obj.serialize(context);
	}

	deserialize(context) {
		if (typeof this.Constructor.deserialize === "function") {
			return this.Constructor.deserialize(context);
		}
		const obj = new this.Constructor();
		obj.deserialize(context);
		return obj;
	}
}

<<<<<<< HEAD
=======
/**
 * @param {Constructor} Constructor the constructor
 * @param {string} request the request which will be required when deserializing
 * @param {string | null} [name] the name to make multiple serializer unique when sharing a request
 */
>>>>>>> 39788b5e01a4817c1ea46a2f2383841e87dacb23
module.exports = (Constructor, request, name = null) => {
	register(Constructor, request, name, new ClassSerializer(Constructor));
};
